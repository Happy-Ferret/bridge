<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Tutorial: Plugin: Streams</title>
  <script src="scripts/prettify/prettify.js"></script>
  <script src="scripts/prettify/lang-css.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link rel="stylesheet" href="https://code.cdn.mozilla.net/fonts/fira.css">
  <link rel="stylesheet" href="styles/prettify-tomorrow.css">
  <link rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>
<div id="main"><section>

<header>
    

    <h2>Plugin: Streams</h2>
</header>

<article>
    <p>Some services need to send data in <em>chunks</em> to the clients and also allow
a way of canceling the action before it is completed. For these cases register
the action as a <code>stream()</code>:</p>
<pre class="prettyprint source lang-js"><code>bridge.service('my-service')
  .plugin(streamsService)
  .stream('myStreamingMethod', function(stream, param) {
    if (param === 'foo') {
      stream.write('bar');
    }

    if (param === 'dolor') {
      // abort() is the way to signal to client that action failed
      stream.abort(new TypeError('invalid argument &quot;dolor&quot;'));
      return;
    }

    var timeout = setTimeout(function() {
      stream.write('baz');
      // close() signals that action finished with success
      stream.close();
    }, 10);

    // you should implement the `cancel` method on the `stream` if your service
    // supports cancellation
    stream.cancel = function(reason) {
      clearTimeout(timeout);
      // you can return a promise if cancel is async; or omit return if action
      // is synchronous or you don't want to notify the client about completion
    };
  });</code></pre><pre class="prettyprint source lang-js"><code>var client = bridge.client('my-service')
  .plugin(streamsClient);

var stream = client.stream('myStreamingMethod', 'foo');

// called every time the service sends some data
stream.listen(function(data) {
  console.log('data:', data);
});

// &quot;closed&quot; is a Promise that will be fullfilled when stream is closed with
// success or rejected when the service &quot;abort&quot; the operation
stream.closed.then(onStreamClose, onStreamAbort);

// important to note that not all services are able to handle cancellation
// in those cases the promise will be rejected
stream.cancel('because I want').then(onCancelSuccess, onCancelError);</code></pre><p>PS: The streaming implementation is very basic and doesn't handle
<em>backpressure</em>, buffering and piping; it is just a simple event bridge between
the <code>service</code> and the <code>client</code>. This was done on purpose to avoid complexity.</p>
<p>The methods <code>close()</code>, <code>abort()</code> and <code>write()</code> return Promises that can be used
to validate if action was executed (eg. <code>write</code> have no effect after <code>close</code> so
promise will be rejected).</p>
</article>

</section>
</div>
<nav><h2><a href="index.html">bridge.js</a></h2><h3>Classes</h3><ul><li><a href="Client.html">Client</a></li><li><a href="Service.html">Service</a></li><li><a href="Message.html">Message</a></li><li><a href="Receiver.html">Receiver</a></li><li><a href="Emitter.html">Emitter</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-BroadcastChannel.html">BroadcastChannel</a></li><li><a href="tutorial-Forwarding messages.html">Forwarding messages</a></li><li><a href="tutorial-How it works.html">How it works</a></li><li><a href="tutorial-Plugin_ Streams.html">Plugin: Streams</a></li><li><a href="tutorial-Service events.html">Service events</a></li><li><a href="tutorial-What_s an endpoint_.html">What's an endpoint?</a></li><li><a href="tutorial-Writing plugins.html">Writing plugins</a></li></ul><button class="nav-toggle"></button></nav>
<footer>
  Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0-dev</a> on Wed Aug 19 2015 17:09:37 GMT+0100 (BST)
</footer>
<a href="https://github.com/gaia-components/bridge"><img style="position: fixed; top: 0; right: 0; border: 0; width: 130px; height: 130px;" src="https://aral.github.com/fork-me-on-github-retina-ribbons/right-orange@2x.png" alt="Fork me on GitHub"></a>
<script> window.prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
<script src="scripts/nav.js"></script>
</body>
</html>