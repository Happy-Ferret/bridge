(function(n){if("object"===typeof exports&&"undefined"!==typeof module)module.c=n();else if("function"===typeof define&&define.ha)define([],n);else{var f;"undefined"!==typeof window?f=window:"undefined"!==typeof global?f=global:"undefined"!==typeof self?f=self:f=this;f.ma=n()}})(function(){return function f(d,b,e){function k(a,h){if(!b[a]){if(!d[a]){var m="function"==typeof require&&require;if(!h&&m)return m(a,!0);if(l)return l(a,!0);m=Error("Cannot find module '"+a+"'");throw m.code="MODULE_NOT_FOUND",
m;}m=b[a]={c:{}};d[a][0].call(m.c,function(c){var h=d[a][1][c];return k(h?h:c)},m,m.c,f,d,b,e)}return b[a].c}for(var l="function"==typeof require&&require,g=0;g<e.length;g++)k(e[g]);return k}({1:[function(f,d){var b=d.c=self.threads||{};b.service=f("../src/service");"u"!="undefined"[0]?(void 0)([],function(){return b}):self.threads=b},{"../src/service":5}],2:[function(f,d){function b(d){if(d)return Object.assign(d,b.prototype)}d.c=b;b.prototype={f:function(b,d){this.a||(this.a={});this.a[b]||(this.a[b]=
[]);this.a[b].push(d);return this},H:function(b,d){if(this.a)switch(arguments.length){case 0:this.a={};break;case 1:delete this.a[b];break;default:var e=this.a[b];if(!e)return;var a=e.indexOf(d);~a&&e.splice(a,1)}return this},b:function(b,d){if(this.a)for(var e=this.a[b]||[],e=e.concat(this.a["*"]||[]),a=0;a<e.length;a++)e[a].call(this,d,b);return this}};var e=b.prototype;e.off=e.H;e.on=e.f},{}],3:[function(f,d,b){function e(c){this.F=!1;this.C=null;this.s=[];this.onMessage=this.onMessage.bind(this);
this.u=this.u.bind(this);"object"===typeof c?this.ea(c):this.fa(c)}function k(c){this.name=c;this.ports=new Set;this.onMessage=this.onMessage.bind(this);this.listen=this.listen.bind(this);this.unlisten=this.unlisten.bind(this)}function l(c){return Error({1:".send() can only be called once",2:"response already sent for this message"}[c])}var g=f("./port-adaptors"),a=f("../emitter");f=f("../utils");var h=f.D,m=f.A;b=d.c=function(c){return new e(c)};b.I=function(c){return new k(c)};b.B=k;b.i=e;e.prototype=
{O:1E3,fa:function(c){this.id=m();this.type=c;this.V=!1;this.o="*"},ea:function(c){this.G=!1;this.K(c.source||c.target);this.event=c;Object.assign(this,c.data)},K:function(c){this.source=g(c,{ready:!0});return this},set:function(c,h){"object"==typeof c?Object.assign(this,c):this[c]=h;return this},da:function(){return{id:this.id,type:this.type,data:this.data,o:this.o,m:this.m}},N:function(){this.defaultPrevented=!0},send:function(c){if(this.V)throw l(1);var a=this.da(),b=!this.m;this.i=h();this.U=
this.i.v;this.port=g(c||this.endpoint);b?(this.l(this.port),this.C=setTimeout(this.u,this.O)):this.i.resolve();this.port.postMessage(a,this.T());return b?this.U:Promise.resolve()},T:function(){return this.X||this.event&&this.event.ports},onMessage:function(c){c.data.response&&c.data.id===this.id&&!this.F&&this.ba(c)},u:function(){this.ka||this.i.reject("no response");this.w()},l:function(c){c=g(c);c.addListener(this.onMessage);this.s.push(c);return this},h:function(){var c=this;this.s.forEach(function(h){return h.removeListener(c.onMessage)});
this.s=[]},L:function(){this.w();this.F=!0;this.b("cancel")},w:function(){clearTimeout(this.C);this.h()},g:function(c){function h(c){b({type:"resolve",value:c})}function a(c){b({type:"reject",value:c.message||c})}function b(c){d.response=c;d.source.postMessage({id:d.id,response:c},d.X)}if(this.G)throw l(2);if(this.source&&!this.m){var d=this;c instanceof Error&&a(c);Promise.resolve(c).then(h,a).catch(a);d.G=!0}},M:function(c){var h=this;return this.set("silentTimeout",!0).send(c).then(function(c){return h.g(c.value)})},
ba:function(c){var h=this.i,a=c.data.response,b="reject"==a.type?a.value:a;a.event=c;this.response=a;this.w();h[this.response.type](b);this.b("response",a)}};d=e.prototype;d.forward=d.M;d.respond=d.g;d.preventDefault=d.N;d.cancel=d.L;d.send=d.send;d.set=d.set;a(e.prototype);k.prototype={l:function(c){c=g(c||self,{I:!0});if(!this.ports.has(c))return c.addListener(this.onMessage,this.l),this.ports.add(c),this},h:function(){var c=this;this.ports.forEach(function(a){a.removeListener(c.onMessage,c.h)})},
onMessage:function(c){if(c.data.id&&c.data.type&&this.W(c.data.o)&&(c=new e(c),this.b("message",c),!c.defaultPrevented))try{this.b(c.type,c)}catch(a){throw c.g(a),a;}},W:function(c){return c==this.name||"*"==c||"*"==this.name},j:function(){this.h();delete this.name;return this}};d=k.prototype;d.listen=d.l;d.unlisten=d.h;d.destroy=d.j;a(k.prototype)},{"../emitter":2,"../utils":6,"./port-adaptors":4}],4:[function(f,d){function b(a){this.target=a}function e(a,b,c){a.addEventListener(b,c)}var k=f("../utils").D;
d.c=function(a,d){if(a.addListener)return a;var c=g[a.constructor.name];return c?c(a,d):new b(a)};var l=b.prototype={addListener:function(a){this.target.addEventListener("message",a)},removeListener:function(a){this.target.removeEventListener("message",a)},postMessage:function(a,b){this.target.postMessage(a,b)}},g={HTMLIFrameElement:function(b){var d=a(b);return{addListener:function(c){window.addEventListener("message",c)},removeListener:function(c){window.removeEventListener("message",c)},postMessage:function(c,
a){d.then(function(){b.contentWindow.postMessage(c,"*",a)})}}},ga:function(a,b){function c(){var c=k();a.postMessage("ready?");e(a,"message",function p(b){"ready"==b.data&&(a.removeEventListener("message",p),c.resolve())});return c.v}var d=b&&b.I,f=b&&b.ready,f=f||d?Promise.resolve():c();d&&(a.postMessage("ready"),e(a,"message",function(c){"ready?"==c.data&&a.postMessage("ready")}));return{target:a,addListener:l.addListener,removeListener:l.removeListener,postMessage:function(c,b){f.then(function(){return a.postMessage(c,
b)})}}},Window:function(b,d){var c=d&&d.ready||b===self,c=c?Promise.resolve():a(b);return{addListener:function(c){window.addEventListener("message",c)},removeListener:function(c){window.removeEventListener("message",c)},postMessage:function(a,d){c.then(function(){return b.postMessage(a,"*",d)})}}},SharedWorkerGlobalScope:function(){var a=[];return{postMessage:function(){},addListener:function(b,c){this.onconnect=function(b){b=b.ports[0];a.push(b);b.start();c(b)};self.addEventListener("connect",this.onconnect)},
removeListener:function(b,c){self.removeEventListener("connect",this.onconnect);a.forEach(function(a){a.close();c(a)})}}}},a=function(){if("undefined"!=typeof window){var a=window.opener||window.parent,b=new WeakSet;a!=self&&e(window,"DOMContentLoaded",function q(){window.removeEventListener("DOMContentLoaded",q);a.postMessage("load","*")});e(self,"message",function(a){return"load"==a.data&&b.add(a.source)});return function(a){var d=a.contentWindow||a;if(b.has(d)||d==window.parent)return Promise.resolve();
var h=k();e(window,"message",function p(a){"load"==a.data&&a.source==d&&(window.removeEventListener("message",p),h.resolve())});return h.v}}}()},{"../utils":6}],5:[function(f,d){function b(a){if(!(this instanceof b))return new b(a);l.B.call(this,a);this.clients={};this.methods={};this.f("_disconnect",this.onDisconnect.bind(this)).f("_connect",this.Y.bind(this)).f("_method",this.Z.bind(this)).f("_off",this.$.bind(this)).f("_on",this.aa.bind(this));this.j=this.j.bind(this)}function e(a){return Error({4:'method "'+
[].slice.call(arguments,1)[0]+"\" doesn't exist"}[a])}var k=f("./utils").A,l=f("./message"),g=l.B;d.c=b;b.prototype=Object.create(g.prototype);b.prototype.method=function(a,b){this.methods[a]=b;return this};b.prototype.R=function(a,b,d){var c={type:a,data:b};this.S(function(a){d&&!~d.indexOf(a.id)||l("_broadcast").set({o:a.id,m:!0,data:c}).send(a.endpoint)});return this};b.prototype.S=function(a){for(var b in this.clients)a(this.clients[b])};b.prototype.Y=function(a){var b=a.data,d=b.ja;if(d&&b.la===
this.name&&!this.clients[d]&&(this.b("before-connect",a),!a.defaultPrevented)){if(b=(b=a.event.ports)&&b[0])a.K(b),this.l(b),b.start();this.P(d,a.source);a.g();this.b("connected",d)}};b.prototype.onDisconnect=function(a){var b=this.clients[a.data];b&&(this.b("before-disconnect",a),a.defaultPrevented||(this.J(b.id),a.g(),this.b("disconnected",b.id)))};b.prototype.Z=function(a){this.b("before-method",a);if(!a.defaultPrevented){var b=a.data,d=b.name,c=this.methods[d];if(!c)throw e(4,d);a.g(c.apply(this,
b.ia))}};b.prototype.aa=function(a){this.b("on",a.data)};b.prototype.$=function(a){this.b("off",a.data)};b.prototype.P=function(a,b){this.clients[a]={id:a,endpoint:b}};b.prototype.J=function(a){delete this.clients[a]};b.prototype.ca=function(a){a(this,{message:l,A:k});return this};b.prototype.disconnect=function(a){this.J(a.id);l("disconnect").set({o:a.id,m:!0}).send(a.endpoint)};b.prototype.j=function(){delete this.clients;this.h();this.H()};g=b.prototype;g.broadcast=g.R;g.destroy=g.j;g.method=g.method;
g.plugin=g.ca},{"./message":3,"./utils":6}],6:[function(f,d,b){b.A=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var d=16*Math.random()|0;return("x"==b?d:d&3|8).toString(16)})};b.D=function(){var b={};b.v=new Promise(function(d,f){b.resolve=d;b.reject=f});return b}},{}]},{},[1])(1)});
