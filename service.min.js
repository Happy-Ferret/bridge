(function(n){if("object"===typeof exports&&"undefined"!==typeof module)module.c=n();else if("function"===typeof define&&define.ha)define([],n);else{var f;"undefined"!==typeof window?f=window:"undefined"!==typeof global?f=global:"undefined"!==typeof self?f=self:f=this;f.ma=n()}})(function(){return function f(d,b,g){function k(c,e){if(!b[c]){if(!d[c]){var m="function"==typeof require&&require;if(!e&&m)return m(c,!0);if(l)return l(c,!0);m=Error("Cannot find module '"+c+"'");throw m.code="MODULE_NOT_FOUND",
m;}m=b[c]={c:{}};d[c][0].call(m.c,function(a){var e=d[c][1][a];return k(e?e:a)},m,m.c,f,d,b,g)}return b[c].c}for(var l="function"==typeof require&&require,h=0;h<g.length;h++)k(g[h]);return k}({1:[function(f,d){var b=d.c=self.threads||{};b.service=f("../src/service");"u"!="undefined"[0]?(void 0)([],function(){return b}):self.threads=b},{"../src/service":5}],2:[function(f,d){function b(d){if(d)return Object.assign(d,b.prototype)}d.c=b;b.prototype={f:function(b,d){this.a||(this.a={});this.a[b]||(this.a[b]=
[]);this.a[b].push(d);return this},H:function(b,d){if(this.a)switch(arguments.length){case 0:this.a={};break;case 1:delete this.a[b];break;default:var g=this.a[b];if(!g)return;var c=g.indexOf(d);~c&&g.splice(c,1)}return this},b:function(b,d){if(this.a)for(var g=this.a[b]||[],g=g.concat(this.a["*"]||[]),c=0;c<g.length;c++)g[c].call(this,d,b);return this}};var g=b.prototype;g.off=g.H;g.on=g.f},{}],3:[function(f,d,b){function g(a){this.D=!1;this.C=null;this.s=[];this.onMessage=this.onMessage.bind(this);
this.u=this.u.bind(this);"object"===typeof a?this.ca(a):this.da(a)}function k(a){this.name=a;this.ports=new Set;this.onMessage=this.onMessage.bind(this);this.listen=this.listen.bind(this);this.unlisten=this.unlisten.bind(this)}function l(a){return Error({1:".send() can only be called once",2:"response already sent for this message"}[a])}var h=f("./port-adaptors"),c=f("../emitter");f=f("../utils");var e=f.F,m=f.A;b=d.c=function(a){return new g(a)};b.I=function(a){return new k(a)};b.B=k;b.ga=g;g.prototype=
{timeout:1E3,da:function(a){this.id=m();this.type=a;this.aa=!1;this.m="*"},ca:function(a){this.G=!1;this.K(a.source||a.target);this.event=a;Object.assign(this,a.data)},K:function(a){this.source=h(a,{ready:!0});return this},set:function(a,e){"object"==typeof a?Object.assign(this,a):this[a]=e;return this},ba:function(){return{id:this.id,type:this.type,data:this.data,m:this.m,l:this.l}},N:function(){this.defaultPrevented=!0},send:function(a){if(this.aa)throw l(1);var c=this.ba(),b=!this.l;this.o=e();
this.$=this.o.v;this.port=h(a||this.endpoint);b?(this.j(this.port),this.C=setTimeout(this.u,this.timeout)):this.o.resolve();this.port.postMessage(c,this.S());return b?this.$:Promise.resolve()},S:function(){return this.ea||this.event&&this.event.ports},onMessage:function(a){a.data.response&&a.data.id===this.id&&!this.D&&this.Y(a)},u:function(){this.la||this.o.reject("no response");this.w()},j:function(a){a=h(a);a.addListener(this.onMessage);this.s.push(a);return this},h:function(){var a=this;this.s.forEach(function(e){return e.removeListener(a.onMessage)});
this.s=[]},L:function(){this.w();this.D=!0;this.b("cancel")},w:function(){clearTimeout(this.C);this.h()},g:function(a){function e(a){b({type:"resolve",value:a})}function c(a){b({type:"reject",value:a&&a.message||a})}function b(a){d.response=a;d.source.postMessage({id:d.id,response:a},d.ea)}if(this.G)throw l(2);if(this.source&&!this.l){var d=this;a instanceof Error&&c(a);Promise.resolve(a).then(e,c).catch(c);d.G=!0}},M:function(a){var e=this;return this.set("silentTimeout",!0).send(a).then(function(a){return e.g(a.value)})},
Y:function(a){var e=this.o,c=a.data.response,b="reject"==c.type?c.value:c;c.event=a;this.response=c;this.w();e[this.response.type](b);this.b("response",c)}};d=g.prototype;d.forward=d.M;d.respond=d.g;d.preventDefault=d.N;d.cancel=d.L;d.send=d.send;d.set=d.set;c(g.prototype);k.prototype={j:function(a){a=h(a||self,{I:!0});if(!this.ports.has(a))return a.addListener(this.onMessage,this.j),this.ports.add(a),this},h:function(){var a=this;this.ports.forEach(function(e){e.removeListener(a.onMessage,a.h)})},
onMessage:function(a){if(a.data.id&&a.data.type&&this.T(a.data.m)&&(a=new g(a),this.b("message",a),!a.defaultPrevented))try{this.b(a.type,a)}catch(e){throw a.g(e),e;}},T:function(a){return a==this.name||"*"==a||"*"==this.name},i:function(){this.h();delete this.name;return this}};d=k.prototype;d.listen=d.j;d.unlisten=d.h;d.destroy=d.i;c(k.prototype)},{"../emitter":2,"../utils":6,"./port-adaptors":4}],4:[function(f,d){function b(e){this.target=e}function g(e,c,a){e.addEventListener(c,a)}var k=f("../utils").F;
d.c=function(e,c){if(!e)throw Error({1:"target is undefined"}[1]);if(e&&e.addListener)return e;var a=h[e.constructor.name];return a?a(e,c):new b(e)};var l=b.prototype={constructor:b,addListener:function(e){this.target.addEventListener("message",e)},removeListener:function(e){this.target.removeEventListener("message",e)},postMessage:function(e,c){this.target.postMessage(e,c)}},h={HTMLIFrameElement:function(e){var b=c(e);return{addListener:function(a){window.addEventListener("message",a)},removeListener:function(a){window.removeEventListener("message",
a)},postMessage:function(a,c){b.then(function(){e.contentWindow.postMessage(a,"*",c)})}}},fa:function(c,b){function a(){var a=k();c.postMessage("ready?");g(c,"message",function p(b){"ready"==b.data&&(c.removeEventListener("message",p),a.resolve())});return a.v}var d=b&&b.I,f=b&&b.ready,f=f||d?Promise.resolve():a();d&&(c.postMessage("ready"),g(c,"message",function(a){"ready?"==a.data&&c.postMessage("ready")}));return{target:c,addListener:l.addListener,removeListener:l.removeListener,postMessage:function(a,
b){f.then(function(){return c.postMessage(a,b)})}}},Window:function(e,b){var a=b&&b.ready||e===self,a=a?Promise.resolve():c(e);return{addListener:function(a){window.addEventListener("message",a)},removeListener:function(a){window.removeEventListener("message",a)},postMessage:function(c,b){a.then(function(){return e.postMessage(c,"*",b)})}}},SharedWorkerGlobalScope:function(){var c=[];return{postMessage:function(){},addListener:function(b,a){this.onconnect=function(b){b=b.ports[0];c.push(b);b.start();
a(b)};self.addEventListener("connect",this.onconnect)},removeListener:function(b,a){self.removeEventListener("connect",this.onconnect);c.forEach(function(c){c.close();a(c)})}}}},c=function(){if("undefined"!=typeof window){var c=window.opener||window.parent,b=new WeakSet;c!=self&&g(window,"DOMContentLoaded",function q(){window.removeEventListener("DOMContentLoaded",q);c.postMessage("load","*")});g(self,"message",function(c){return"load"==c.data&&b.add(c.source)});return function(c){var e=c.contentWindow||
c;if(b.has(e)||e==window.parent)return Promise.resolve();var d=k();g(window,"message",function p(c){"load"==c.data&&c.source==e&&(window.removeEventListener("message",p),d.resolve())});return d.v}}}()},{"../utils":6}],5:[function(f,d){function b(c){if(!(this instanceof b))return new b(c);l.B.call(this,c);this.clients={};this.methods={};this.f("_disconnect",this.onDisconnect.bind(this)).f("_connect",this.U.bind(this)).f("_method",this.V.bind(this)).f("_off",this.W.bind(this)).f("_on",this.X.bind(this));
this.i=this.i.bind(this)}function g(c){return Error({4:'method "'+[].slice.call(arguments,1)[0]+"\" doesn't exist"}[c])}var k=f("./utils").A,l=f("./message"),h=l.B;d.c=b;b.prototype=Object.create(h.prototype);b.prototype.method=function(c,b){this.methods[c]=b;return this};b.prototype.P=function(c,b,d){var a={type:c,data:b};this.R(function(c){d&&!~d.indexOf(c.id)||l("_broadcast").set({m:c.id,l:!0,data:a}).send(c.endpoint)});return this};b.prototype.R=function(c){for(var b in this.clients)c(this.clients[b])};
b.prototype.U=function(c){var b=c.data,d=b.ja;if(d&&b.ka===this.name&&!this.clients[d]&&(this.b("before-connect",c),!c.defaultPrevented)){if(b=(b=c.event.ports)&&b[0])c.K(b),this.j(b),b.start();this.O(d,c.source);c.g();this.b("connected",d)}};b.prototype.onDisconnect=function(c){var b=this.clients[c.data];b&&(this.b("before-disconnect",c),c.defaultPrevented||(this.J(b.id),c.g(),this.b("disconnected",b.id)))};b.prototype.V=function(c){this.b("before-method",c);if(!c.defaultPrevented){var b=c.data,
d=b.name,a,f=this.methods[d];if(!f)throw g(4,d);try{a=f.apply(this,b.ia)}catch(h){a=h}c.g(a)}};b.prototype.X=function(c){this.b("on",c.data)};b.prototype.W=function(c){this.b("off",c.data)};b.prototype.O=function(c,b){this.clients[c]={id:c,endpoint:b}};b.prototype.J=function(c){delete this.clients[c]};b.prototype.Z=function(c){c(this,{message:l,A:k});return this};b.prototype.disconnect=function(c){this.J(c.id);l("disconnect").set({m:c.id,l:!0}).send(c.endpoint)};b.prototype.i=function(){delete this.clients;
this.h();this.H()};h=b.prototype;h.broadcast=h.P;h.destroy=h.i;h.method=h.method;h.plugin=h.Z},{"./message":3,"./utils":6}],6:[function(f,d,b){b.A=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var d=16*Math.random()|0;return("x"==b?d:d&3|8).toString(16)})};b.F=function(){var b={};b.v=new Promise(function(d,f){b.resolve=d;b.reject=f});return b}},{}]},{},[1])(1)});
